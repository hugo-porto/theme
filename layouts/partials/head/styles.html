<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />

<style>
  /* Light/dark theme variables with OS preference fallback */
  :root {
    --site-bg: var(--color-gray-100);
    --site-text: var(--color-gray-700);
    --site-muted: var(--color-gray-500);
    --card-bg: #ffffff;
    --link-color: #3b82f6; /* blue-500 */
    --overlay-bg: rgba(0, 0, 0, 0.6);
    --divider: rgba(0, 0, 0, 0.08);
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --site-bg: #0b1220;
      --site-text: #c9d6e3;
      --site-muted: #98a7b5;
      --card-bg: #07101a;
      --link-color: #60a5fa;
      --overlay-bg: rgba(255, 255, 255, 0.03);
      --divider: rgba(255, 255, 255, 0.12);
    }

    meta[name="theme-color"] {
      color-scheme: dark;
    }
  }

  /* Divider and border tweaks: make "-b-2" visually thinner and theme-aware */
  .border-b-2 {
    border-bottom-width: 1px !important;
  }
  .border-2 {
    border-width: 1px !important;
  }
  .border-gray-300,
  .border-gray-200 {
    border-color: var(--divider) !important;
  }
  .bg-gray-300 {
    background-color: var(--divider) !important;
  }

  html,
  body {
    background-color: var(--site-bg);
    color: var(--site-text);
  }

  /* Hide elements with x-cloak until Alpine initialises */
  [x-cloak] {
    display: none !important;
  }

  .bg-gray-50,
  .bg-white,
  .bg-gray-200 {
    background-color: var(--card-bg) !important;
  }

  .text-gray-700 {
    color: var(--site-text) !important;
  }

  .text-gray-500 {
    color: var(--site-muted) !important;
  }

  .text-blue-500 {
    color: var(--link-color) !important;
  }

  /* Ensure mobile overlay uses theme-aware overlay color */
  .fixed.inset-0.min-h-screen.bg-black {
    background-color: var(--overlay-bg) !important;
  }

  /* Slightly dim the panel border in dark mode */
  .absolute.min-h-screen.bg-gray-200 {
    box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.04) inset;
  }
  /* class-based dark overrides for explicit selection */
  .dark {
    --site-bg: #0b1220;
    --site-text: #c9d6e3;
    --site-muted: #98a7b5;
    --card-bg: #07101a;
    --link-color: #60a5fa;
    --overlay-bg: rgba(255,255,255,0.03);
    --divider: rgba(255,255,255,0.12);
  }

  /* Support data-theme attribute as an alternative hook (stronger targeting) */
  html[data-theme="dark"] {
    --site-bg: #0b1220 !important;
    --site-text: #c9d6e3 !important;
    --site-muted: #98a7b5 !important;
    --card-bg: #07101a !important;
    --link-color: #60a5fa !important;
    --overlay-bg: rgba(255,255,255,0.03) !important;
    --divider: rgba(255,255,255,0.12) !important;
  }

  html[data-theme="light"] {
    --site-bg: var(--color-gray-100) !important;
    --site-text: var(--color-gray-700) !important;
    --site-muted: var(--color-gray-500) !important;
    --card-bg: #ffffff !important;
    --link-color: #3b82f6 !important;
    --overlay-bg: rgba(0,0,0,0.6) !important;
    --divider: rgba(0,0,0,0.08) !important;
  }

  /* Force some high-level properties when explicitly dark/light so they override compiled rules */
  html.dark body, html[data-theme="dark"] body, html[data-theme="light"] body {
    background-color: var(--site-bg) !important;
    color: var(--site-text) !important;
  }
  html.dark .bg-white, html[data-theme="dark"] .bg-white, html[data-theme="light"] .bg-white { background-color: var(--card-bg) !important; }
</style>

<script>
  (function(){
    var KEY = 'theme'; // values: 'light'|'dark'|'system'
    function systemPref(){ return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'; }
    function apply(mode){
      if(mode === 'dark'){
        document.documentElement.classList.add('dark');
        document.documentElement.setAttribute('data-theme','dark');
      } else if(mode === 'light'){
        document.documentElement.classList.remove('dark');
        document.documentElement.setAttribute('data-theme','light');
      } else {
        document.documentElement.classList.remove('dark');
        document.documentElement.removeAttribute('data-theme');
      }
      // when mode === 'system', we remove the class and let prefers-color-scheme handle it
      try{
        // debug removed
      } catch(e){}
    }
    function getStored(){ try { return localStorage.getItem(KEY); } catch(e){ return null; } }
    function setStored(v){ try { localStorage.setItem(KEY, v); } catch(e){} }

    var stored = getStored();
    var initial = stored || 'system';
    if(initial === 'system') {
      // apply current system
      apply(systemPref());
    } else {
      apply(initial);
    }

    // expose helper
    window.__theme = initial;
    window.__getPreferredTheme = function(){ return window.__theme || 'system'; };
    window.__setPreferredTheme = function(mode){
      if(!mode) return;
      if(mode !== 'light' && mode !== 'dark' && mode !== 'system') return;
      setStored(mode);
      window.__theme = mode;
      if(mode === 'system') apply(systemPref()); else apply(mode);
      window.dispatchEvent(new Event('theme-changed'));
    };

    // helper to cycle through values: system -> dark -> light -> system
    window.__cyclePreferredTheme = function(){
      var cur = window.__theme || getStored() || 'system';
      var next = cur === 'system' ? 'dark' : (cur === 'dark' ? 'light' : 'system');
      window.__setPreferredTheme(next);
      return next;
    };

    // Init: listen to system changes when user selected 'system'
    if(window.matchMedia){
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(){
        if((window.__theme || getStored() || 'system') === 'system') apply(systemPref());
      });
    }
  })();
</script>

{{ $styles := resources.Get "css/styles.scss" }}
{{ if $styles }}
  {{ if hugo.IsServer }}
    {{ $styles = $styles | toCSS }}
    <link rel="stylesheet" href="{{ $styles.RelPermalink }}" media="screen" />
  {{ else }}
    {{ $styles = $styles | toCSS | minify | fingerprint }}
    <link
      rel="stylesheet"
      href="{{ $styles.RelPermalink }}"
      integrity="{{ $styles.Data.Integrity }}"
      crossorigin="anonymous"
      media="screen" />
  {{ end }}
{{ end }}
