{{- /*
  Optimized pagination partial
  - Accepts either a page context or a map {page: <context>, format: "default"|"terse"}
  - Renders compact accessible pagination with configurable slot count
  */
-}}

{{- $valid := slice "default" "terse" -}}
{{- $page := . -}}
{{- $format := "default" -}}

{{- if reflect.IsMap . -}}
  {{- with .page -}}
    {{- $page = . -}}
  {{- else -}}
    {{- errorf "When passing a map to this pagination partial, provide 'page'" -}}
  {{- end -}}
  {{- with .format -}}{{- $format = lower . -}}{{- end -}}
{{- end -}}

{{- if not (in $valid $format) -}}
  {{- errorf "Invalid pagination format. Valid: %s" (delimit $valid ", ") -}}
{{- end -}}

{{- with $page.Paginator -}}
  {{- if gt .TotalPages 1 -}}
    <nav class="flex justify-center p-6" aria-label="Pagination">
      <ul class="list-none flex gap-2">
        {{- /* prev */ -}}
        {{- with .Prev -}}
          <li><a href="{{ .URL }}" aria-label="Previous" class="px-3 py-1 rounded hover:bg-gray-50">←</a></li>
        {{- else -}}
          <li><span class="px-3 py-1 rounded text-gray-400">←</span></li>
        {{- end -}}

        {{- /* page window */ -}}
        {{- $p := . -}}
        {{- $slots := cond (eq $format "default") 5 3 -}}
        {{- $half := div $slots 2 -}}
        {{- $start := math.Max 1 (sub $p.PageNumber $half) -}}
        {{- $end := math.Min $p.TotalPages (add $start (sub $slots 1)) -}}
        {{- if lt (add (sub $end $start) 1) $slots -}}
          {{- $start = math.Max 1 (sub $end (sub $slots 1)) -}}
        {{- end -}}

        {{- range $k := seq $start $end -}}
          {{- $pager := index $p.Pagers (sub $k 1) -}}
          {{- if eq $p.PageNumber $k -}}
            <li><span aria-current="page" class="px-3 py-1 rounded bg-gray-50 font-medium">{{ $k }}</span></li>
          {{- else -}}
            <li>
              <a href="{{ $pager.URL }}" aria-label="Page {{ $k }}" class="px-3 py-1 rounded hover:bg-gray-50">
                {{ $k }}
              </a>
            </li>
          {{- end -}}
        {{- end -}}

        {{- /* next */ -}}
        {{- with .Next -}}
          <li><a href="{{ .URL }}" aria-label="Next" class="px-3 py-1 rounded hover:bg-gray-50">→</a></li>
        {{- else -}}
          <li><span class="px-3 py-1 rounded text-gray-400">→</span></li>
        {{- end -}}
      </ul>
    </nav>
  {{- end -}}
{{- end -}}
